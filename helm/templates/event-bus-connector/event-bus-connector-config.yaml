{{- if .Values.eventBusConnector.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: event-bus-connector-config
data:
  connect-standalone.properties: |
     bootstrap.servers = event-bus-service.default.svc.cluster.local:9092
     key.converter=org.apache.kafka.connect.json.JsonConverter
     value.converter=org.apache.kafka.connect.json.JsonConverter
     key.converter.schemas.enable=false
     value.converter.schemas.enable=false
     offset.storage.file.filename=/tmp/connect.offsets
     offset.flush.interval.ms=10000
     plugin.path=/opt/bitnami/kafka/plugins
  postgres.properties: |
    connector.class=io.confluent.connect.jdbc.JdbcSinkConnector
    connection.url={{ .Values.eventBusConnector.dbConnectionString }}
    connection.user={{ .Values.eventBusConnector.dbUser }}
    connection.password={{ .Values.eventBusConnector.dbUserPassword }}
    tasks.max=1
    table.name.format=s_smart_home.\${topic}
    auto.create=true
    auto.evolve=true
    insert.mode=upsert
    name=kafka-postgres-sink-connector
    pk.mode=record_value
    pk.fields=id
    delete.enabled=false  
    key.converter=org.apache.kafka.connect.json.JsonConverter
    value.converter=org.apache.kafka.connect.json.JsonConverter
    errors.log.enable = true
    errors.log.include.messages = true
    topics.regex =^topic.*
    batch.size = 1
{{- end }}